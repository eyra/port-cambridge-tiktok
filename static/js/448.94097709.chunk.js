(()=>{"use strict";function t(t,e){const[n,r]=o(t);let a="hour";return r-n>864e5*e&&(a="day"),r-n>2592e6*e&&(a="month"),r-n>7776e6*e&&(a="quarter"),r-n>31536e6*e&&(a="year"),a}function e(t,e,o){const n={},[r,a]=t;let u=0;if("year"===e&&(u=314496e5),"quarter"===e&&(u=72576e5),["month","month_cycle"].includes(e)&&(u=24192e5),["day","weekday_cycle"].includes(e)&&(u=864e5),["hour","hour_cycle"].includes(e)&&(u=36e5),u>0)for(let l=r;l<=a;l+=u){const t=o(new Date(l));void 0===n[t]&&(n[t]=l)}return n}function o(t){let e=t[0],o=t[0];return t.forEach((t=>{t<e&&(e=t),t>o&&(o=t)})),[e,o]}function n(t){return t.split(" ").filter((t=>/\p{L}/giu.test(t)))}function r(t,e){const o=t.head.cells.findIndex((t=>t.text===e));if(o<0)throw new Error("column ".concat(t.id,".").concat(e," not found"));return t.body.rows.map((t=>t.cells[o].text))}function a(t,e,o,n,r){let a=(t-e)/(o-e);return a=isNaN(a)?0:a,a*(r-n)+n}async function u(n,a){if(0===n.body.rows.length)return l(a);const u=function(n,a){const u={},{groupBy:l,xSortable:c}=function(n,a){let u=r(n,a.group.column);if(0===u.length)throw new Error("X column ".concat(n.id,".").concat(a.group.column," not found"));let l=null;void 0!==a.group.dateFormat&&([u,l]=function(n,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,u=n;const l=n.map((t=>new Date(t).getTime()));let c=null,s=t=>t.toISOString();"auto"===r&&(r=t(l,a)),"year"===r&&(s=t=>t.getFullYear().toString()),"quarter"===r&&(s=t=>{const e=t.getFullYear().toString(),o=Math.floor(t.getMonth()/3)+1;return"".concat(e,"-Q").concat(o)}),"month"===r&&(s=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"});return"".concat(e,"-").concat(o)}),"day"===r&&(s=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"}),n=t.getDate().toString();return"".concat(e,"-").concat(o,"-").concat(n)}),"hour"===r&&(s=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"}),n=t.getDate().toString(),r=t.toISOString().split("T")[1].split(":")[0];return"".concat(e,"-").concat(o,"-").concat(n," ").concat(r,":00")}),"month_cycle"===r&&(s=t=>new Intl.DateTimeFormat("default",{month:"long"}).format(t),c=[new Date("2000-01-01").getTime(),new Date("2001-01-01").getTime()]),"weekday_cycle"===r&&(s=t=>new Intl.DateTimeFormat("default",{weekday:"long"}).format(t),c=[new Date("2023-11-06").getTime(),new Date("2023-11-13").getTime()]),"hour_cycle"===r&&(s=t=>new Intl.DateTimeFormat("default",{hour:"numeric",hour12:!1}).format(t),c=[new Date("2000-01-01").getTime(),new Date("2000-01-02").getTime()]),u=l.map((t=>s(new Date(t)))),null==c&&(c=o(l));const i=e(c,r,s);return[u,i]}(u,a.group.dateFormat));if(void 0!==a.group.levels){l={};for(let t=0;t<a.group.levels.length;t++){l[a.group.levels[t]]=t}}return{groupBy:u,xSortable:l}}(n,a),s=n.body.rows.map((t=>t.id)),i=void 0!==a.group.label?a.group.label:a.group.column;if(a.values.some((t=>!0===t.addZeroes))&&null!=c)for(const[t,e]of Object.entries(c))u[t]={sortBy:e,rowIds:{},xLabel:i,xValue:t,values:{},secondAxis:!1,tickerFormat:"default"};for(const t of a.values){var d;const e=void 0!==t.aggregate?t.aggregate:"count";let o="default";"pct"!==e&&"count_pct"!==e||(o="percent");const f=r(n,t.column);if(0===f.length)throw new Error("Y column ".concat(n.id,".").concat(t.column," not found"));const v=void 0!==t.group_by?r(n,t.group_by):null,p=null!==(d=t.addZeroes)&&void 0!==d&&d,y={};for(let n=0;n<s.length;n++){var m;const r=l[n];if(void 0!==a.group.range&&(Number(r)<a.group.range[0]||Number(r)>a.group.range[1]))continue;const d=f[n],p=void 0!==t.label?t.label:t.column,h=null!=v?v[n]:p,w=null!=c?c[r]:l[n];var g;if(void 0===y[h]&&(y[h]={n:0,sum:0}),"count_pct"!==e&&"mean"!==e||(y[h].n+=1),"pct"===e&&(y[h].sum+=null!==(m=Number(d))&&void 0!==m?m:0),void 0===u[r]&&(u[r]={sortBy:w,rowIds:{},xLabel:i,xValue:String(r),values:{},secondAxis:t.secondAxis,tickerFormat:o}),void 0===u[r].rowIds[h]&&(u[r].rowIds[h]=[]),u[r].rowIds[h].push(s[n]),void 0===u[r].values[h]&&(u[r].values[h]=0),"count"!==e&&"count_pct"!==e||(u[r].values[h]+=1),"sum"===e||"mean"===e||"pct"===e)u[r].values[h]+=null!==(g=Number(d))&&void 0!==g?g:0}Object.keys(y).forEach((t=>{for(const o of Object.keys(u)){if(void 0===u[o].values[t]){if(!p)continue;u[o].values[t]=0}"mean"===e&&(u[o].values[t]=Number(u[o].values[t])/y[t].n),"count_pct"===e&&(u[o].values[t]=100*Number(u[o].values[t])/y[t].n),"pct"===e&&(u[o].values[t]=100*Number(u[o].values[t])/y[t].sum)}}))}return u}(n,a);return function(t,e){const o=l(t);for(const n of Object.values(e))for(const t of Object.keys(n.values))void 0===o.yKeys[t]&&(o.yKeys[t]={label:t,secondAxis:n.secondAxis,tickerFormat:n.tickerFormat});return o.data=Object.values(e).sort(((t,e)=>t.sortBy<e.sortBy?-1:e.sortBy<t.sortBy?1:0)).map((t=>{for(const e of Object.keys(t.values))t.values[e]=Math.round(100*t.values[e])/100;return{...t.values,[t.xLabel]:t.xValue,__rowIds:t.rowIds,__sortBy:t.sortBy}})),o}(a,u)}function l(t){return{type:t.type,xKey:{label:void 0!==t.group.label?t.group.label:t.group.column},yKeys:{},data:[]}}async function c(t,e){const o={type:e.type,topTerms:[]};if(0===t.body.rows.length)return o;const u=r(t,e.textColumn),l=function(t,e,o){const r={};for(let u=0;u<t.length;u++){if(null==(null===t||void 0===t?void 0:t[u]))continue;const l=t[u],c=null!=o.tokenize&&o.tokenize?n(l):[l],s=new Set;for(const t of c){var a;void 0===r[t]&&(r[t]={value:0,docFreq:0}),s.has(t)||(r[t].docFreq+=1,s.add(t));const o=null!==(a=Number(null===e||void 0===e?void 0:e[u]))&&void 0!==a?a:1;isNaN(o)||(r[t].value+=o)}}return r}(u,null!=e.valueColumn?r(t,e.valueColumn):null,e);return o.topTerms=function(t,e,o){const n=Object.entries(t).map((t=>{let[o,n]=t;const r=Math.log(1+n.value),a=Math.log(e/n.docFreq);return{text:o,value:n.value,importance:r*a}})).sort(((t,e)=>e.importance-t.importance)).slice(0,o),r=Math.min(...n.map((t=>t.importance))),u=Math.max(...n.map((t=>t.importance)));return n.map((t=>({text:t.text,value:t.value,importance:a(t.importance,r,u,0,1)})))}(l,u.length,200),o}self.onmessage=t=>{(async function(t,e){if(void 0===t||void 0===e)throw new Error("Table and visualization are required");if(["line","bar","area"].includes(e.type))return await u(t,e);if(["wordcloud"].includes(e.type))return await c(t,e);throw new Error("Visualization type ".concat(e.type," not supported"))})(t.data.table,t.data.visualization).then((t=>{self.postMessage({status:"success",visualizationData:t})})).catch((t=>{console.error(t),self.postMessage({status:"error",visualizationData:void 0})}))}})();
//# sourceMappingURL=448.94097709.chunk.js.map