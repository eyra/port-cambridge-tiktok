(()=>{"use strict";function t(t,e){const o=Math.min(...t),n=Math.max(...t);let r="hour";return n-o>864e5*e&&(r="day"),n-o>2592e6*e&&(r="month"),n-o>7776e6*e&&(r="quarter"),n-o>31536e6*e&&(r="year"),r}function e(t,e,o){const n={},[r,a]=t;let u=0;if("year"===e&&(u=314496e5),"quarter"===e&&(u=72576e5),["month","month_cycle"].includes(e)&&(u=24192e5),["day","weekday_cycle"].includes(e)&&(u=864e5),["hour","hour_cycle"].includes(e)&&(u=36e5),u>0)for(let l=r;l<=a;l+=u){const t=o(new Date(l));void 0===n[t]&&(n[t]=l)}return n}function o(t){return t.split(" ").filter((t=>/\p{L}/giu.test(t)))}function n(t,e){const o=t.head.cells.findIndex((t=>t.text===e));if(o<0)throw new Error("column ".concat(t.id,".").concat(e," not found"));return t.body.rows.map((t=>t.cells[o].text))}function r(t,e,o,n,r){return(t-e)/(o-e)*(r-n)+n}async function a(o,r){if(0===o.body.rows.length)return u(r);const a=function(o,r){const a={},{groupBy:u,xSortable:l}=function(o,r){let a=n(o,r.group.column);if(0===a.length)throw new Error("X column ".concat(o.id,".").concat(r.group.column," not found"));let u=null;void 0!==r.group.dateFormat&&([a,u]=function(o,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=o;const u=o.map((t=>new Date(t).getTime()));let l=null,c=t=>t.toISOString();"auto"===n&&(n=t(u,r)),"year"===n&&(c=t=>t.getFullYear().toString()),"quarter"===n&&(c=t=>{const e=t.getFullYear().toString(),o=Math.floor(t.getMonth()/3)+1;return"".concat(e,"-Q").concat(o)}),"month"===n&&(c=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"});return"".concat(e,"-").concat(o)}),"day"===n&&(c=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"}),n=t.getDate().toString();return"".concat(e,"-").concat(o,"-").concat(n)}),"hour"===n&&(c=t=>t.toISOString().split("T")[1].split(":")[0]),"month_cycle"===n&&(c=t=>new Intl.DateTimeFormat("default",{month:"long"}).format(t),l=[new Date("2000-01-01").getTime(),new Date("2001-01-01").getTime()]),"weekday_cycle"===n&&(c=t=>new Intl.DateTimeFormat("default",{weekday:"long"}).format(t),l=[new Date("2023-11-06").getTime(),new Date("2023-11-13").getTime()]),"hour_cycle"===n&&(c=t=>new Intl.DateTimeFormat("default",{hour:"numeric",hour12:!1}).format(t),l=[new Date("2000-01-01").getTime(),new Date("2000-01-02").getTime()]),a=u.map((t=>c(new Date(t)))),null==l&&(l=[Math.min(...u),Math.max(...u)]);const s=e(l,n,c);return[a,s]}(a,r.group.dateFormat));if(void 0!==r.group.levels){u={};for(let t=0;t<r.group.levels.length;t++){u[r.group.levels[t]]=t}}return{groupBy:a,xSortable:u}}(o,r),c=o.body.rows.map((t=>t.id)),s=void 0!==r.group.label?r.group.label:r.group.column;for(const t of r.values){var i;const e=void 0!==t.aggregate?t.aggregate:"count";let v="default";"pct"!==e&&"count_pct"!==e||(v="percent");const g=n(o,t.column);if(0===g.length)throw new Error("Y column ".concat(o.id,".").concat(t.column," not found"));const f=void 0!==t.group_by?n(o,t.group_by):null,p=null!==(i=t.addZeroes)&&void 0!==i&&i,y={};if(p&&null!=l)for(const[o,n]of Object.entries(l))a[o]={sortBy:n,rowIds:{},xLabel:s,xValue:o,values:{},secondAxis:t.secondAxis,tickerFormat:v};for(let o=0;o<c.length;o++){var d;const n=u[o];if(void 0!==r.group.range&&(Number(n)<r.group.range[0]||Number(n)>r.group.range[1]))continue;const i=g[o],p=void 0!==t.label?t.label:t.column,h=null!=f?f[o]:p,w=null!=l?l[n]:u[o];var m;if(void 0===y[h]&&(y[h]={n:0,sum:0}),"count_pct"!==e&&"mean"!==e||(y[h].n+=1),"pct"===e&&(y[h].sum+=null!==(d=Number(i))&&void 0!==d?d:0),void 0===a[n]&&(a[n]={sortBy:w,rowIds:{},xLabel:s,xValue:String(n),values:{},secondAxis:t.secondAxis,tickerFormat:v}),void 0===a[n].rowIds[h]&&(a[n].rowIds[h]=[]),a[n].rowIds[h].push(c[o]),void 0===a[n].values[h]&&(a[n].values[h]=0),"count"!==e&&"count_pct"!==e||(a[n].values[h]+=1),"sum"===e||"mean"===e||"pct"===e)a[n].values[h]+=null!==(m=Number(i))&&void 0!==m?m:0}Object.keys(y).forEach((t=>{for(const o of Object.keys(a)){if(void 0===a[o].values[t]){if(!p)continue;a[o].values[t]=0}"mean"===e&&(a[o].values[t]=Number(a[o].values[t])/y[t].n),"count_pct"===e&&(a[o].values[t]=100*Number(a[o].values[t])/y[t].n),"pct"===e&&(a[o].values[t]=100*Number(a[o].values[t])/y[t].sum)}}))}return a}(o,r);return function(t,e){const o=u(t);for(const n of Object.values(e))for(const t of Object.keys(n.values))void 0===o.yKeys[t]&&(o.yKeys[t]={label:t,secondAxis:n.secondAxis,tickerFormat:n.tickerFormat});return o.data=Object.values(e).sort(((t,e)=>t.sortBy<e.sortBy?-1:e.sortBy<t.sortBy?1:0)).map((t=>{for(const e of Object.keys(t.values))t.values[e]=Math.round(100*t.values[e])/100;return{...t.values,[t.xLabel]:t.xValue,__rowIds:t.rowIds,__sortBy:t.sortBy}})),o}(r,a)}function u(t){return{type:t.type,xKey:{label:void 0!==t.group.label?t.group.label:t.group.column},yKeys:{},data:[]}}async function l(t,e){const a={type:e.type,topTerms:[]};if(0===t.body.rows.length)return a;const u=n(t,e.textColumn),l=function(t,e,n){const r={};for(let u=0;u<t.length;u++){if(null==(null===t||void 0===t?void 0:t[u]))continue;const l=t[u],c=null!=n.tokenize&&n.tokenize?o(l):[l],s=new Set;for(const t of c){var a;void 0===r[t]&&(r[t]={value:0,docFreq:0}),s.has(t)||(r[t].docFreq+=1,s.add(t));const o=null!==(a=Number(null===e||void 0===e?void 0:e[u]))&&void 0!==a?a:1;isNaN(o)||(r[t].value+=o)}}return r}(u,null!=e.valueColumn?n(t,e.valueColumn):null,e);return a.topTerms=function(t,e,o){const n=Object.entries(t).map((t=>{let[o,n]=t;const r=Math.log(1+n.value),a=Math.log(e/n.docFreq);return{text:o,value:n.value,importance:r*a}})).sort(((t,e)=>e.importance-t.importance)).slice(0,o),a=Math.min(...n.map((t=>t.importance))),u=Math.max(...n.map((t=>t.importance)));return n.map((t=>({text:t.text,value:t.value,importance:r(t.importance,a,u,0,1)})))}(l,u.length,200),a}self.onmessage=t=>{(async function(t,e){if(void 0===t||void 0===e)throw new Error("Table and visualization are required");if(["line","bar","area"].includes(e.type))return await a(t,e);if(["wordcloud"].includes(e.type))return await l(t,e);throw new Error("Visualization type ".concat(e.type," not supported"))})(t.data.table,t.data.visualization).then((t=>{self.postMessage({status:"success",visualizationData:t})})).catch((t=>{console.error(t),self.postMessage({status:"error",visualizationData:void 0})}))}})();
//# sourceMappingURL=448.2cb2cbcf.chunk.js.map